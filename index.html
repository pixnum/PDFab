<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PDF Generator ‚Äî ¬© Manik Roy 2025</title>
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='18' fill='%232a9d8f'/%3E%3Ctext x='50' y='58' font-size='48' font-family='Arial' fill='white' text-anchor='middle'%3EMR%3C/text%3E%3C/svg%3E" />
<style>
  :root{
    --bg:#f6f7fb; --ui:#ffffff; --muted:#6b7280; --accent:#2563eb; --text:#0b1220;
  }
  @media (prefers-color-scheme:dark){
    :root{ --bg:#0b1020; --ui:#071022; --muted:#9aa9bf; --accent:#60a5fa; --text:#e6eef8; }
  }
  *{box-sizing:border-box}
  body{ margin:16px; font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial; background:linear-gradient(180deg,var(--bg),var(--ui)); color:var(--text); }
  .app{ max-width:1200px; margin:0 auto; display:flex; flex-direction:column; gap:12px; }

  header{ display:flex; justify-content:space-between; align-items:center; gap:12px; }
  .brand{ display:flex; gap:12px; align-items:center; }
  .icon{ width:46px; height:46px; border-radius:10px; background:linear-gradient(135deg,var(--accent),#2a9d8f); color:white; display:flex;align-items:center;justify-content:center;font-weight:700; box-shadow:0 6px 18px rgba(0,0,0,0.08); }
  .title{ font-weight:700; } .sub{ color:var(--muted); font-size:13px; }

  .toolbar{ display:flex; flex-wrap:wrap; gap:8px; padding:8px; border-radius:10px; background:var(--ui); box-shadow:0 6px 18px rgba(2,6,23,0.06); align-items:center; }
  .toolbar button, .toolbar select, .toolbar input[type=color], .toolbar input[type=range], .toolbar input[type=file], .toolbar input[type=number]{
    padding:8px 10px; border-radius:8px; border:1px solid rgba(0,0,0,0.06); background:transparent; color:var(--text); cursor:pointer;
  }
  .toolbar .primary{ background:linear-gradient(90deg,var(--accent),#2a9d8f); color:white; border:none; }

  .workspace{ display:flex; gap:16px; margin-top:12px; align-items:flex-start; }
  .left{ flex:1; min-width:300px; display:flex; flex-direction:column; gap:12px; }
  .canvas-wrap{ display:flex; justify-content:center; }
  .page{ width:100%; max-width:820px; min-height:1120px; background:var(--ui); border-radius:12px; padding:28px; box-shadow:0 12px 40px rgba(2,6,23,0.06); display:flex; flex-direction:column; gap:12px; }
  .editor{ flex:1; padding:18px; outline:none; min-height:420px; margin:0 auto; max-width:760px; color:var(--text); font-size:16px; line-height:1.5; text-align:center; border-radius:8px; background:transparent; overflow-wrap:break-word; word-break:break-word; }
  .page-footer{ display:flex; justify-content:space-between; color:var(--muted); font-size:13px; padding-top:12px; border-top:1px dashed rgba(0,0,0,0.04); }

  .right{ width:320px; display:flex; flex-direction:column; gap:12px; }
  .panel{ padding:12px; background:var(--ui); border-radius:12px; box-shadow:0 10px 30px rgba(2,6,23,0.04); }
  .panel h4{ margin:0 0 8px 0; color:var(--muted); font-size:13px; }

  .editor img.inserted-image{ display:block; margin:8px auto; max-width:100%; height:auto; border-radius:6px; box-shadow:0 6px 18px rgba(0,0,0,0.06); cursor:pointer; }
  .editor img.selected{ outline:3px solid rgba(37,99,235,0.18); }

  .small{ font-size:13px; color:var(--muted); }
  @media (max-width:920px){ .workspace{ flex-direction:column; } .right{ width:100%; } .page{ max-width:680px; min-height:900px; } }

  /* Print rules - exact colors + margin-safe content + image scaling */
  @media print{
    *{ -webkit-print-color-adjust:exact !important; print-color-adjust:exact !important; color-adjust:exact !important; }
    body *{ visibility:hidden; }
    #print-frame, #print-frame *{ visibility:visible; }
    #print-frame{ position:fixed; left:0; top:0; width:100%; height:100%; }
    .print-page{ box-sizing:border-box; word-wrap:break-word; overflow-wrap:break-word; }
    .print-page img{ max-width:100% !important; height:auto !important; page-break-inside:avoid; display:block; margin:8px 0; }
  }
</style>
</head>
<body>
  <div class="app" role="application" aria-label="PDF Generator by Manik Roy 2025">
    <header>
      <div class="brand">
        <div class="icon" aria-hidden="true">MR</div>
        <div>
          <div class="title">PDF Generator</div>
          <div class="sub">¬© Manik Roy 2025 ‚Äî Responsive ‚Ä¢ Offline</div>
        </div>
      </div>
      <div style="display:flex;gap:10px;align-items:center;">
        <div class="small">Auto theme</div>
        <button id="themeToggle" title="Toggle theme">Toggle Theme</button>
        <button id="exportBtn" class="primary" title="Export to PDF">Export as PDF</button>
      </div>
    </header>

    <div class="workspace">
      <div class="left">
        <div class="toolbar" role="toolbar" aria-label="Formatting toolbar">
          <div style="display:flex;gap:8px;align-items:center;">
            <button data-cmd="bold" title="Bold"><b>B</b></button>
            <button data-cmd="italic" title="Italic"><i>I</i></button>
            <button data-cmd="underline" title="Underline"><u>U</u></button>
          </div>

          <select id="fontSelect" title="Font family">
            <option value="inherit">System</option>
            <option value="Georgia, serif">Georgia</option>
            <option value="'Times New Roman', Times, serif">Times New Roman</option>
            <option value="Arial, Helvetica, sans-serif" selected>Arial</option>
            <option value="Verdana, sans-serif">Verdana</option>
            <option value="'Courier New', monospace">Courier New</option>
          </select>

          <input type="number" id="fontSize" title="Font size (px)" style="width:84px" min="8" max="72" value="18">

          <input type="color" id="colorPicker" title="Text color" value="#111827" />

          <div style="margin-left:auto;display:flex;gap:6px;">
            <button data-cmd="justifyLeft" title="Align left">‚üµ</button>
            <button data-cmd="justifyCenter" title="Align center">‚§í</button>
            <button data-cmd="justifyRight" title="Align right">‚ü∂</button>
            <button data-cmd="justifyFull" title="Justify">‚ò∞</button>
          </div>

          <input id="imgUpload" type="file" accept="image/*" style="display:none" />
          <button id="imgBtn" title="Insert image">üì∑ Insert Image</button>

          <button id="clearBtn" title="Clear formatting">Clear</button>
        </div>

        <div class="canvas-wrap">
          <div class="page" role="document" aria-label="Document page preview">
            <div contenteditable="true" id="editor" class="editor" spellcheck="true" aria-multiline="true" aria-label="Document editor">
              <h1 style="margin-top:0;">Your title here</h1>
              <p>Start typing... default alignment is center. Insert images by clicking Insert Image or dragging one into this area.</p>
            </div>

            <div class="page-footer">
              <div class="small" id="pageInfo">A4 ‚Ä¢ Portrait</div>
              <div class="small">¬© Manik Roy 2025</div>
            </div>
          </div>
        </div>
      </div>

      <aside class="right">
        <div class="panel">
          <h4>Page</h4>
          <div style="display:flex;gap:8px;margin-bottom:8px;">
            <label class="small">Size</label>
            <select id="pageSize">
              <option value="A4" selected>A4 (210√ó297mm)</option>
              <option value="Letter">Letter (8.5√ó11in)</option>
            </select>
          </div>
          <div style="display:flex;gap:8px;margin-bottom:8px;">
            <label class="small">Orientation</label>
            <select id="orientation">
              <option value="portrait" selected>Portrait</option>
              <option value="landscape">Landscape</option>
            </select>
          </div>
          <div style="display:flex;gap:8px;">
            <label class="small">Margins (px)</label>
            <input id="margins" type="number" value="28" min="0" max="120" style="width:80px" />
          </div>
        </div>

        <div class="panel">
          <h4>Document</h4>
          <div style="display:flex;flex-direction:column;gap:8px;">
            <input id="docTitle" type="text" placeholder="Document title" value="PDF Generator ‚Äî ¬© Manik Roy 2025" />
            <input id="docAuthor" type="text" placeholder="Author" value="Manik Roy" />
            <div style="display:flex;gap:8px;">
              <button id="previewBtn">Preview</button>
              <button id="downloadBtn" class="primary">Export PDF</button>
            </div>
          </div>
        </div>

        <div class="panel small">
          <strong>Tips</strong>
          <ul style="margin:6px 0 0 18px;padding:0;color:var(--muted)">
            <li>Drag & drop images into the editor.</li>
            <li>Click an image to select and use the slider to adjust width (%).</li>
            <li>Use Export to open print dialog (Save as PDF).</li>
          </ul>
        </div>
      </aside>
    </div>

    <footer style="text-align:center;color:var(--muted);font-size:13px;padding:8px;">Built with ‚ù§Ô∏è ‚Ä¢ ¬© Manik Roy 2025</footer>

    <iframe id="print-frame" style="display:none;width:100%;height:100%;"></iframe>
  </div>

<script>
  // Elements
  const editor = document.getElementById('editor');
  const toolbar = document.querySelector('.toolbar');
  const colorPicker = document.getElementById('colorPicker');
  const fontSelect = document.getElementById('fontSelect');
  const fontSize = document.getElementById('fontSize');
  const exportBtn = document.getElementById('exportBtn');
  const previewBtn = document.getElementById('previewBtn');
  const downloadBtn = document.getElementById('downloadBtn');
  const pageSizeSelect = document.getElementById('pageSize');
  const orientationSelect = document.getElementById('orientation');
  const marginsInput = document.getElementById('margins');
  const docTitleInput = document.getElementById('docTitle');
  const docAuthorInput = document.getElementById('docAuthor');
  const imgUpload = document.getElementById('imgUpload');
  const imgBtn = document.getElementById('imgBtn');
  const pageInfo = document.getElementById('pageInfo');
  const clearBtn = document.getElementById('clearBtn');

  // default center alignment
  document.execCommand('justifyCenter', false, null);

  // Toolbar: execCommand for bold/italic/underline and alignment
  toolbar.addEventListener('click', (e) => {
    const btn = e.target.closest('button[data-cmd]');
    if (!btn) return;
    const cmd = btn.dataset.cmd;
    document.execCommand('styleWithCSS', false, true);
    document.execCommand(cmd, false, null);
    editor.focus();
  });

  // Helper: apply inline style to the current selection (fontFamily, fontSize, color)
  function applyStyleToSelection(styleProp, value) {
    const sel = window.getSelection();
    if (!sel || !sel.rangeCount) {
      // No selection, apply default style on editor for typing
      editor.style[styleProp] = value;
      return;
    }
    const range = sel.getRangeAt(0);
    if (range.collapsed) {
      editor.style[styleProp] = value;
      return;
    }
    // Wrap selection in span with style
    const content = range.extractContents();
    const wrapper = document.createElement('span');
    wrapper.style[styleProp] = value;
    wrapper.style.display = 'inline';
    wrapper.appendChild(content);
    range.insertNode(wrapper);

    // Move caret after inserted span
    sel.removeAllRanges();
    const newRange = document.createRange();
    newRange.setStartAfter(wrapper);
    newRange.collapse(true);
    sel.addRange(newRange);
  }

  // Font family change
  fontSelect.addEventListener('change', () => {
    const font = fontSelect.value;
    applyStyleToSelection('fontFamily', font === 'inherit' ? '' : font);
    editor.focus();
  });

  // Font size (px) change
  fontSize.addEventListener('input', () => {
    let px = fontSize.value;
    if (!px || px < 1) px = 16;
    applyStyleToSelection('fontSize', px + 'px');
    editor.focus();
  });

  // Color picker: apply color to selection
  colorPicker.addEventListener('input', () => {
    applyStyleToSelection('color', colorPicker.value);
    editor.focus();
  });

  // Clear formatting but keep text, with center alignment
  clearBtn.addEventListener('click', () => {
    // Unwrap all styled spans
    editor.querySelectorAll('span').forEach(s => {
      if (s.style.length > 0) {
        const parent = s.parentNode;
        while (s.firstChild) parent.insertBefore(s.firstChild, s);
        parent.removeChild(s);
      }
    });
    // Remove inline styles from all elements except images
    editor.querySelectorAll('*').forEach(el => {
      if (el.tagName.toLowerCase() !== 'img') el.removeAttribute('style');
    });
    // Rewrap content with center aligned div
    const text = editor.innerText;
    editor.innerHTML = '<div style="text-align:center;">' + text.replace(/\n/g, '<br>') + '</div>';
  });

  // Page info update
  function updatePageInfo() {
    pageInfo.textContent = pageSizeSelect.value + ' ‚Ä¢ ' + (orientationSelect.value === 'portrait' ? 'Portrait' : 'Landscape');
  }
  pageSizeSelect.addEventListener('change', updatePageInfo);
  orientationSelect.addEventListener('change', updatePageInfo);
  updatePageInfo();

  // Image insertion fix: insert at caret position
  imgBtn.addEventListener('click', () => imgUpload.click());
  imgUpload.addEventListener('change', e => {
    const file = e.target.files[0];
    if (file && file.type.startsWith('image/')) {
      const reader = new FileReader();
      reader.onload = () => {
        const img = document.createElement('img');
        img.src = reader.result;
        img.className = 'inserted-image';
        img.style.width = '80%';
        img.style.cursor = 'pointer';
        insertImageAtCaret(img);
      };
      reader.readAsDataURL(file);
    }
    e.target.value = ''; // Reset file input
  });

  function insertImageAtCaret(img) {
    const sel = window.getSelection();
    if (!sel.rangeCount) {
      editor.appendChild(img);
      return;
    }
    const range = sel.getRangeAt(0);
    range.deleteContents();
    range.insertNode(img);
    range.setStartAfter(img);
    range.collapse(true);
    sel.removeAllRanges();
    sel.addRange(range);
    editor.focus();
  }

  // Export PDF: print via hidden iframe for best fidelity
  exportBtn.addEventListener('click', () => {
    const pageWidth = pageSizeSelect.value === 'Letter' ? 612 : 595.28;
    const pageHeight = pageSizeSelect.value === 'Letter' ? 792 : 841.89;
    const orientation = orientationSelect.value;
    const margin = parseInt(marginsInput.value) || 28;

    const htmlContent = `
    <html>
      <head>
        <title>${docTitleInput.value}</title>
        <style>
          @page { size: ${pageSizeSelect.value} ${orientation}; margin: ${margin}px; }
          body {
            font-family: Arial, sans-serif;
            font-size: 18px;
            color: #111;
            padding: ${margin}px;
            margin:0;
            word-wrap: break-word;
            overflow-wrap: break-word;
            background: white;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
          }
          img {
            max-width: 100%;
            height: auto;
            page-break-inside: avoid;
            display: block;
            margin: 12px auto;
          }
          div { word-break: break-word; }
        </style>
      </head>
      <body>
        <div>${editor.innerHTML}</div>
        <footer style="font-size: 12px; color: #777; margin-top: 40px; text-align: center;">¬© Manik Roy 2025</footer>
      </body>
    </html>`;

    const printFrame = document.getElementById('print-frame');
    printFrame.style.display = 'block';
    printFrame.srcdoc = htmlContent;
    printFrame.onload = () => {
      printFrame.contentWindow.focus();
      printFrame.contentWindow.print();
      printFrame.style.display = 'none';
    };
  });

  // Theme toggle button
  const themeToggle = document.getElementById('themeToggle');
  themeToggle.addEventListener('click', () => {
    document.body.classList.toggle('dark-mode');
  });

</script>
</body>
</html>
